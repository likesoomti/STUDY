#  chap11 시스템

##### 시스템 = 도시

도시는 한사람의 힘으로 세울 수 없습니다.

도시관리팀 / 수도관리팀 등 분야를 관리하고, 작은 사항에 집중하는 사람들로 인해 도시가 돌아갑니다.



프로그래밍도 마찬가지입니다.

높은 추상화 수준을 시스템 수준에서 구현하고 깨끗하게 유지하는 방법을 알아봅시다.



### 1. 시스템 제작과 시스템 사용을 분리합니다.

개발과 프로덕션 모드는 아주 다릅니다. 

호텔 또한 만드는 사람은 안전모를 쓰고 작업복을 입고 엄청 열심히 일하지만, 

호텔에서 일하는 사람들은 다른 차림에, 완공 된 후 멋진 인테리어 속에 일하게 됩니다.

따라서 **소프트웨어** 또한 준비 과정과 **런타임 로직**을 분리해야 합니다.



##### 시작 단계

1. 시작 단계에서는 **관심사를 분리**해야합니다. 

   불행히, 대다수 어플리 케이션은 시작 단계라는 관심사를 분리하지 않고, 주먹 구구식으로 구현합니다.

   ```java
   // 초기화 / 계산 지연 기법 -> 나중에 객체를 생성하는 기법 
   // 주먹 구구식 예제
   // 런타임 로직과 마구 뒤섞임 
   public Service getService(){
     if( service == null)
       service = new MyServiceImpl(...); // 모든 상황에 적합한 기본값인가?
     return sservice;
   }
   ```

   장점

   1. 실제로 필요할 때 까지 객체를 생성하지 않으므로 과부하에 걸리지 않습니다.
   2. 어떤 경우에도 null 포인트를 반환하지 않습니다.

   문제점

   1. getService() 메서드가 MyServiceImpl 과 생성자 인수에 명시적으로 의존합니다.
   2. 의존성을 해결하지 않으면 컴파일이 되지 않습니다.
   3. getService를 호출하기 전에, 테스트 전용 객체를 service 필드에 할당해야 합니다. 
   4. 런타임로직 / 객체 생성 로직 -> 2가지 이상 일을 수행하므로 **SRP** 원칙에 위반합니다.
   5. MyServiceImpl 이 모든 상황에 적합한 기본값인지도 모릅니다.

체계적이고, 탄탄한 시스템을 만들기 위해서는 손쉬운 기법으로 모듈성을 깨서는 안됩니다. 

또한 의조성을 해소하기 위한 방식도 필요합니다.



##### Main 분리

시스템 생성과 시스템 사용을 분리하는 한가지 방법입니다. 

생성과 관련한 코드는 모두 main이나 main이 호출하는 코드로 옮기고,

나머지 시스템은 모든 객체가 생성되었고, 모든 의존성이 연결되어있다고 가정합니다. 

따라서 나머지 시스템들은 객체가 생성되는 과정을 모릅니다.



##### 팩토리

객체가 생성되는 시점을 애플리케이션이 모를 경우 

추상 팩토리 패턴을 사용하여, 어플리케이션이 객체가 생성되는 시점은 결정하지만, 추상화를 통해 숨긴다. 



##### 의존성 주입

사용과 제작을 분리하는 강력한 메커니즘

한 객체가 맡은 보조 책임을 새로운 객체에게 전적으로 떠넘긴다.

따라서 책임이 분리되며 ,  SRP 를 지키게 된다. 

시스템 전체에서 필요하므로 책임질 메커니즘으로 main 루틴이나 **특수 컨테이너**를 사용한다.

*특수 컨테이너*:  DI 컨테이너, 프로그래밍 외부 설정파일에서 구성요소 의존 관계를 설정 . java spring 프레임워크에서는 이런 컨테이너를 제공해준다.

대다수의 컨테이너는 필요할때 까지 객체를 생성하지 않고, 대부분 계산 지연이나 비슷한 최적화에 쓸 수 있도록 팩토릴르 호출하거나 프록시를 생성하는 방법을 제공한다.



### 2. 확장

마을은 도시로 확장된다. 

시스템 또한 확장된다. 처음부터 '올바르게' 시스템을 만들 수 있다는 믿음은 미신이다.

점진적인 애자일 방식에서는 내일 새로운 스토리에 맞춰 시스템을 구현해야한다. 

`TDD`, `리팩토링` 으로 인한 깨끗한 코드는 코드 수준에서 시스템을 조정하고 확장하기 쉽게 만든다.



하지만 시스템 아키텍쳐는 사전 계획이 필요하다. 관심사를 적절히 분리해 관리해 점진적으로 발전시켜야 한다.

-----

11장 이후의 개념은 아직 나의 영역이 아닌것같다... 스프링을 공부한 이후 할 것 !